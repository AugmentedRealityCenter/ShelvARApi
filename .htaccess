Header set Access-Control-Allow-Origin *

#This htaccess file implements site-based
# licensing for ShelvAR. Each supported site needs
# a rule that sets their institution code.

RewriteEngine On

RewriteRule ^$ http://devapi.shelvar.com/doc [R=301,L]
RewriteRule ^doc - [L]
RewriteRule ^error_log - [L]

RewriteRule ^deploy - [L]
RewriteRule ^ShelvARLogo_Big.png - [L]

###########
## OAuth ##
###########
RewriteCond %{THE_REQUEST} GET
RewriteRule ^oauth/whoami$ api/oauth/whoami.php [L]

RewriteCond %{THE_REQUEST} GET
RewriteRule ^oauth/login$ oauth/login.php [L]

RewriteCond %{THE_REQUEST} POST
RewriteRule ^oauth/login$ oauth/login.php [L]

#These should probably just use AliasMatch in httpd.conf
RewriteRule ^oauth/get_access_token$ oauth/access_token.php [L]
RewriteRule ^oauth/get_request_token$ oauth/request_token.php [L]
RewriteRule ^oauth/post_login$ oauth/post-login.php [L]
RewriteRule ^oauth/register_user$ oauth/register_user.php [L]

###########
### API ###
###########

# Condition for GET/POST requests that are also API calls.
# An API call is defined as a URI request for anything that is not
# a file. Note: chaining RewriteConds is equivalent to:
# (cond1 && cond2), which is what we want in this case.
# The following lines make calls to the api wrapper
# and specify whether or not they were GET or POST while
# also specifying the URI. An errant URI specification
# results in a 404 being thrown by the apiwrapper.

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*+)$ front_controller.php?path=$1 [L,QSA]

